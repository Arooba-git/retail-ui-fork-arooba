package patches.buildTypes

import jetbrains.buildServer.configs.kotlin.v2019_2.*
import jetbrains.buildServer.configs.kotlin.v2019_2.ui.*

/*
This patch script was generated by TeamCity on settings change in UI.
To apply the patch, change the buildType with id = 'ReactUI_Publish'
accordingly, and delete the patch script.
*/
changeBuildType(RelativeId("ReactUI_Publish")) {
    expectSteps {
        step {
            name = "Install"
            type = "jonnyzzz.yarn"
            param("yarn_commands", "install")
        }
        step {
            name = "Auth"
            type = "jonnyzzz.npm"
            param("npm_commands", """config set "//registry.npmjs.org/:_authToken" "%env.NPM_TOKEN%"""")
        }
        step {
            name = "Publish"
            type = "jonnyzzz.yarn"
            param("yarn_commands", "workspace @skbkontur/react-ui release")
        }
        step {
            name = "Clean"
            type = "jonnyzzz.npm"
            executionMode = BuildStep.ExecutionMode.ALWAYS
            param("npm_commands", """config delete "//registry.npmjs.org/:_authToken"""")
        }
    }
    steps {
        insert(2) {
            step {
                name = "Set registry (need update NPM - https only)"
                type = "jonnyzzz.npm"
                param("npm_commands", "config set registry https://registry.npmjs.org/")
            }
        }
    }
}
